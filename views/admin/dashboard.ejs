<%- include('../admin/layouts/adminHeader.ejs')%>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

            <!-- Content-->
<section class="col-lg-9 pt-lg-4 pb-4 mb-3">
  <div class="pt-2 px-4 ps-lg-0 pe-xl-5">


        <!-- Title-->
        <div class="d-sm-flex flex-wrap justify-content-between align-items-center border-bottom">
            <h2 class="h3 py-2 text-sm-start">Dashboard</h2>
            <div>
            </div>
          </div>

          <div style="overflow-x: auto; max-height: 460px;" data-simplebar>

          <div class="card bg-faded-info border-0 mt-2 m-0 shadow-lg">
            <div class="card-body text-center d-flex justify-content-evenly flex-wrap">

                <div class="card bg-faded-info border-0 m-0 shadow-lg">
                    <div class="card-body text-center">
                        <h4 class="text-muted m-0">Total Users</h4>
                        <h4 class="text-muted m-0" id="userCount"><%=userCount %></h4>
                    </div>
                  </div>

                  <div class="card bg-faded-info border-0 m-0 shadow-lg">
                    <div class="card-body text-center">
                        <h4 class="text-muted m-0">Total Products</h4>
                        <h4 class="text-muted m-0" id="productCount"><%=productCount %></h4>
                    </div>
                  </div>

                  <div class="card bg-faded-info border-0 m-0 shadow-lg">
                    <div class="card-body text-center">
                        <h4 class="text-muted m-0">Total Sales</h4>
                        <h4 class="text-muted m-0" id="salesCount"><%=sales %></h4>
                    </div>
                  </div>

                  <div class="card bg-faded-info border-0 m-0 shadow-lg">
                    <div class="card-body text-center">
                        <h4 class="text-muted m-0">Total Revenue</h4>
                        <h4 class="text-muted m-0" id="userCount"><%=totalPrice %></h4>
                    </div>
                  </div>

            </div>
        </div>

        <div class="d-flex justify-content-center mt-3">
            <div>
            <div id="pie" class="example mb-3" style="width: 300px;">
            </div>
            
          <div class="d-flex justify-content-center flex-column align-items-center mt-10" style="width: 100%; height: 12rem;">
            <div class="d-flex">
                <div class="me-2" style="width: 20px; height: 20px; background-color:#2DB1E4;"></div>
                <p style="font-size: 14px; font-weight: 500;"><i> Order Placed</i></p>
            </div>
            <div class="d-flex">
                <div class="me-2" style="width: 20px; height: 20px; background-color:#9CCA13;"></div>
                <p style="font-size: 14px; font-weight: 500;"><i> Order Delivered</i> </p>
            </div>
            <div class="d-flex">
                <div class="me-2" style="width: 20px; height: 20px; background-color:#A4075E;"></div>
                <p style="font-size: 14px; font-weight: 500;"><i> Order Canceled</i> </p>
            </div>
            <div class="d-flex">
                <div class="me-2" style="width: 20px; height: 20px; background-color:#2E8B57;"></div>
                <p style="font-size: 14px; font-weight: 500;"><i> Order Returned</i> </p>
            </div>
            <div class="d-flex">
                <div class="me-2" style="width: 20px; height: 20px; background-color:#660000;"></div>
                <p style="font-size: 14px; font-weight: 500;"><i> Order Approved</i> </p>
            </div><div class="d-flex">
                <div class="me-2" style="width: 20px; height: 20px; background-color:#FF9933;"></div>
                <p style="font-size: 14px; font-weight: 500;"><i> Order Packed</i> </p>
            </div><div class="d-flex">
                <div class="me-2" style="width: 20px; height: 20px; background-color:#663399;"></div>
                <p style="font-size: 14px; font-weight: 500;"><i> Order Shipped</i> </p>
            </div><div class="d-flex">
                <div class="me-2" style="width: 20px; height: 20px; background-color:#009933;"></div>
                <p style="font-size: 14px; font-weight: 500;"><i> Return Request</i> </p>
            </div><div class="d-flex">
                <div class="me-2" style="width: 20px; height: 20px; background-color:#CC3333;"></div>
                <p style="font-size: 14px; font-weight: 500;"><i> Return Rejected</i> </p>
            </div><div class="d-flex">
                <div class="me-2" style="width: 20px; height: 20px; background-color:#003366;"></div>
                <p style="font-size: 14px; font-weight: 500;"><i> Order Rejected</i> </p>
            </div>
        </div>
    </div>
</div>

    <% if(saleDummy.length>0){%>
      <%}else{%>
        <p id="orderPlaced" style="display: none;"> <%=orderConf %> </p>
        <p id="orderCancel" style="display: none;"> <%=orderCancel %> </p>
        <p id="orderDelivered" style="display: none;"> <%=orderDeli %> </p>
        <p id="orderReturn" style="display: none;"> <%=orderReturn %> </p>
        <p id="orderApproved" style="display: none;"> <%=orderApproved %> </p>
        <p id="orderPacked" style="display: none;"> <%=orderPacked %> </p>
        <p id="orderShipped" style="display: none;"> <%=orderShipped %> </p>
        <p id="returnRequest" style="display: none;"> <%=returnRequest %> </p>
        <p id="returnRejected" style="display: none;"> <%=returnRejected %> </p>
        <p id="orderRejected" style="display: none;"> <%=orderRejected %> </p>
      <%} %>
    
   



                </div>
            </section>
        </div>
     </div>
    </div>
</main>


<script>

(function($){

function radialProgress($obj, options) {
var defaults = {
  "inline": true,
  "font-size": 40,
  "font-family": "Helvetica, Arial, sans-serif",
  "text-color": null,
  "lines": 1,
  "line": 0,
  "symbol": "",
  "margin": 0, 
  "color": "rgb(55,123,181)",
  "background": "rgba(185, 177, 181, 0.22)",
  "size": $obj.outerWidth(),
  "fill": "5px",
  "range": [0, 100]
};
this.options = $.extend(defaults, options);

this.first_rot_base = -135;
this.second_rot_base = -315;

this.options['size'] = parseInt(this.options['size'], 10);
this.options['fill'] = parseInt(this.options['fill'], 30);
this.options['font-size'] = parseInt(this.options['font-size'], 10);
this.options['margin'] = Math.max(0, parseInt(this.options['margin'], 10));
this.options['text-color'] = this.options['text-color'] || this.options['color'];

$obj.css({
  "position": "relative",
  "width": this.options['size'],
  "height": this.options['size'],
  "display": this.options['inline'] ? "inline-block" : "block"
});
  
this.$radialBackground = $("<div>").appendTo($obj).css({
  "box-sizing": "border-box",
  "-moz-box-sizing": "border-box",
  "-webkit-box-sizing": "border-box",
  "position": "absolute",
  "top": this.options['margin'],
  "left": this.options['margin'],
  "width": this.options['size'] - this.options['margin'] * 2,
  "height": this.options['size'] - this.options['margin'] * 2,
  "border": this.options['fill'] + "px solid " + this.options['background'],
  "border-radius": Math.ceil(this.options['size'] / 2) + "px",
});

this.$radialFirstHalfMask = $("<div>").appendTo($obj).css({
  "position": "absolute",
  "top": this.options['margin'],
  "right": this.options['margin'],
  "width": Math.round(this.options['size'] / 2) - this.options['margin'],
  "height": this.options['size'] - this.options['margin'] * 2,
  "overflow": "hidden"
});

this.$radialSecondHalfMask = $("<div>").appendTo($obj).css({
  "position": "absolute",
  "top": this.options['margin'],
  "left": this.options['margin'],
  "width": Math.round(this.options['size'] / 2) - this.options['margin'],
  "height": this.options['size'] - this.options['margin'] * 2,
  "overflow": "hidden"
});

this.$radialFirstHalf = $("<div>").appendTo(this.$radialFirstHalfMask).css({
  "box-sizing": "border-box",
  "-moz-box-sizing": "border-box",
  "-webkit-box-sizing": "border-box",
  "position": "absolute",
  "top": "0px",
  "border-width": this.options['fill'],
  "border-style": "solid",
  "border-color": this.options['color'] + " " + this.options['color'] + " transparent transparent",
  "width": "200%",
  "height": "100%",
  "border-radius": "50%",
  "left": "-100%",
  "transform": "rotate(" + this.first_rot_base + "deg)"
});

this.$radialSecondHalf = $("<div>").appendTo(this.$radialSecondHalfMask).css({
  "box-sizing": "border-box",
  "-moz-box-sizing": "border-box",
  "-webkit-box-sizing": "border-box",
  "position": "absolute",
  "top": "0px",
  "border-width": this.options['fill'],
  "border-style": "solid",
  "border-color": this.options['color'] + " " + this.options['color'] + " transparent transparent",
  "width": "200%",
  "height": "100%",
  "border-radius": "50%",
  "left": "0px",
  "transform": "rotate(" + this.second_rot_base + "deg)"
});

if (this.options['text-color']) {
  this.$radialLabel = $("<div>").appendTo($obj).css({
    "position": "absolute",
    "font-size": this.options['font-size'] + "px",
    "font-family": this.options['font-family'],
    "color": this.options['text-color'],
    "left": "50%",
    "top": "50%",
    "transform": "translate(-50%, -50%)"
  });
}

this.perc = 0;
this.queue = [];
}

radialProgress.prototype.toPerc = function(options) {
var self = this,
    offset = options['offset'] || 0,
    interval_delay = 10,
    time = options['time'] || 1000,
    targetPerc = Math.max(0, Math.min(100, (options['perc'] - self.options['range'][0]) / (self.options['range'][1] - self.options['range'][0]) * 100)),
    diffPerc = targetPerc - this.perc,
    direction = diffPerc / Math.abs(diffPerc),
    step = diffPerc / (time / interval_delay);
if (!this.animation) {
  this.animation = setInterval(function() {
    if ((direction > 0 && self.perc >= targetPerc) || (direction < 0 && self.perc <= targetPerc)) {
      window.clearInterval(self.animation);
      self.animation = null;
      var next = self.queue.shift();
      if (next) self.toPerc(next);
      return;
    }
    self.perc += step;
    var first_rot = self.first_rot_base;
    var second_rot = self.second_rot_base;
    if (self.perc < 50) {
      first_rot = self.first_rot_base + (self.perc / 50) * 180;
      second_rot = self.second_rot_base;
    } else {
      first_rot = self.first_rot_base + 1 * 180;
      second_rot = self.second_rot_base + ((self.perc - 50) / 50) * 180;
    }
    self.$radialFirstHalf.css({
      "transform": "rotate(" + first_rot + "deg)"
    });
    self.$radialSecondHalf.css({
      "transform": "rotate(" + second_rot + "deg)"
    });
    if (self.$radialLabel) {
      var value = targetPerc ? self.perc/targetPerc * (targetPerc - offset) : 0;
      value = self.options['range'][0] + value / 100 * (self.options['range'][1] - self.options['range'][0]);
      var text = Math.round(value + self.options['symbol']);
      for (var ti = 0; ti < self.options['line']; ti++) text = "&nbsp;<br>" + text;
      for (var ti = self.options['lines'] - (self.options['line'] + 1); ti > 0; ti--) text = text + "<br>&nbsp;";
      self.$radialLabel.html(text);
    }
  }, interval_delay);
} else {
  this.queue.push(options);
}
};

$.fn.radialProgress = function(func, options) {
if (func === "init") {
  $(this).data("__radialProgress", new radialProgress($(this), options));
} else if ($(this).data("__radialProgress")) {
  if (func === "to") $(this).data("__radialProgress").toPerc(options)
}
return this;
};

$.fn.radialPieChart = function(func, options) {
if (func === "init") {
  var sum = options['data'].reduce(function(a, item) {
    return a + item.perc;
  }, 0);
  for (var i = 0; i < options['data'].length; i++) {
    $(this).data("__pieChartSegment" + i, new radialProgress($(this), $.extend(options, options['data'][i], {'lines': options['data'].length, 'line': i })));      
    $(this).data("__pieChartSegment" + i).toPerc({'perc': sum, 'offset': sum - options['data'][i].perc});
    sum -= options['data'][i].perc;
  }
}
return this;
};

$.fn.radialMultiProgress = function(func, options) {
if (func === "init") {
  var space = options['space'] || 2,
      segmentFill = Math.floor(options['fill'] / options['data'].length) - space,
      margin = 0;
  for (var i = 0; i < options['data'].length; i++) {
    $(this).data("__multiProgress" + i, new radialProgress($(this), $.extend(options, options['data'][i], {'fill': segmentFill, 'margin': margin, 'lines': options['data'].length, 'line': i })));
    margin += segmentFill + space;
  }
}
else if (options['index'] !== undefined) {
  if ($(this).data("__multiProgress" + options['index'])) {
    if (func === "to") $(this).data("__multiProgress" + options['index']).toPerc(options);
  }
}
else if (options['list'] !== undefined) {
  for (var i = 0; i < options['list'].length; i++) {
    if (func === "to") $(this).data("__multiProgress" + options['list'][i]['index']).toPerc(options['list'][i]);
  }
}
return this;
};

})(jQuery);

const orderPlaced = document.getElementById('orderPlaced').innerText;
const orderCancel = document.getElementById('orderCancel').innerText;
const orderDelivered = document.getElementById('orderDelivered').innerText;
const orderReturn = document.getElementById('orderReturn').innerText;
const orderApproved = document.getElementById('orderApproved').innerText;
const orderPacked = document.getElementById('orderPacked').innerText;
const orderShipped = document.getElementById('orderShipped').innerText;
const returnRequest = document.getElementById('returnRequest').innerText;
const returnRejected = document.getElementById('returnRejected').innerText;
const orderRejected = document.getElementById('orderRejected').innerText;

jQuery("#pie").radialPieChart("init", {
'font-size': 10,
'fill': 20,
'data': [
  {'color': "#2DB1E4", 'perc':  + orderPlaced},
  {'color': "#9CCA13", 'perc':  + orderDelivered},
  {'color': "#A4075E", 'perc': + orderCancel},
  {'color': "#2E8B57", 'perc': + orderReturn},
  {'color': "#660000", 'perc': + orderApproved},
  {'color': "#FF9933", 'perc': + orderPacked},
  {'color': "#663399", 'perc': + orderShipped},
  {'color': "#009933", 'perc': + returnRequest},
  {'color': "#CC3333", 'perc': + returnRejected},
  {'color': "#003366", 'perc': + orderRejected},
]
});

</script>

<%- include('../admin/layouts/adminFooter.ejs')%>